# ðŸ¦ ëª¨ìž„ ë²Œê¸ˆ í†µìž¥ ì„œë¹„ìŠ¤

- ê¸°ê°„ ë° ì¸ì›: 2024.09 ~ 2024.10 (ì¸ì› 6ëª…)
- ê¸°ìˆ ìŠ¤íƒ: JPA, JavaScript, React, Spring Boot, redis
- ë‹´ë‹¹ì—­í• : íŒ€ìž¥, BackEnd, ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ì„¤ê³„

---

## 1) í”„ë¡œì íŠ¸ ê°œìš”

- ëª©í‘œ: ëª¨ìž„ êµ¬ì„±ì›ì˜ ë¯¸ì…˜ ìˆ˜í–‰ì„ ê¸°ë°˜ìœ¼ë¡œ ë²Œê¸ˆÂ·ìƒê¸ˆì´ ìžë™ ì •ì‚°ë˜ëŠ” **ê¸ˆìœµí˜• í˜‘ì—… ì„œë¹„ìŠ¤** ë°±ì—”ë“œ êµ¬ì¶•
- í•µì‹¬ ê°€ì¹˜: **ì •í™•í•œ ì •ì‚°(ACID)** Â· **ì¤‘ë³µ ì—†ëŠ” ì´ë²¤íŠ¸ ì²˜ë¦¬(idempotency)** Â· **ì•ˆì „í•œ ì¸ì¦/ì¸ê°€(HTTP-Only Cookie, JWT)**
- í”„ë¡ íŠ¸ ìš”êµ¬ì‚¬í•­ ìš”ì•½(ì—°ë™):
    - GPS/ì‚¬ì§„ ê¸°ë°˜ ë¯¸ì…˜ íŒë³„
    - ì¹´ì¹´ì˜¤í†¡ ì´ˆëŒ€(ë§í¬) & ì¹´ì¹´ì˜¤ë§µ ìœ„ì¹˜ í‘œì‹œ
    - íŒ€ë³„ ë°°íŒ… â†’ ê²°ê³¼ ë°˜ì˜ â†’ ìžë™ ì •ì‚°/ìº˜ë¦°ë”/ê°¤ëŸ¬ë¦¬

---

## 2) ì•„í‚¤í…ì²˜ ê°œìš”

- **ê¸°ìˆ  ìŠ¤íƒ:**
    
    Spring Boot Â· Java Â· MySQL Â· Redis(ë¶„ì‚°ë½/ìºì‹œ) Â· Kafka(ë¹„ë™ê¸° ì´ë²¤íŠ¸) Â· Docker Â· Jenkins
    
    (ë°°í¬: AWS EC2, Nginx ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ)
    

```
[Client(Web/App)]
   â”‚ REST API
   â–¼
[Spring Boot Backend]
   â”œâ”€ Auth Service (JWT/ì¿ í‚¤)
   â”œâ”€ Mission Service (GPS/ì‚¬ì§„ ë©”íƒ€)
   â”œâ”€ Betting Service (ë°°íŒ…/ì •ì‚° ëŒ€ê¸°)
   â”œâ”€ Settlement Service (ì •ì‚°/ì›ìž¥)
   â”œâ”€ Notification Service (Kafka ì´ë²¤íŠ¸)
   â””â”€ Media Service (S3 ì—…ë¡œë“œ/ì²˜ë¦¬)
```
### ERD

    ![image.png](/images/godLifeRouting/GodLifeRoutine%20v2.png)

---

## 3) í•µì‹¬ ì‹œí€€ìŠ¤ ì„¤ê³„

**A. ì´ˆëŒ€ ë° ê°€ìž…**

1. ë°±ì—”ë“œ â†’ ì´ˆëŒ€ í† í° ìƒì„± (`invitations.token`)
2. ì¹´ì¹´ì˜¤í†¡ ë§í¬ë¡œ ì „ë‹¬
3. ì‹ ê·œ ì‚¬ìš©ìžê°€ ë§í¬ í´ë¦­ â†’ íšŒì›ê°€ìž… & ê·¸ë£¹ ë“±ë¡

**B. ë¯¸ì…˜ íŒë³„**

1. ë¯¸ì…˜ ìƒì„± (`missions`)
2. ì‚¬ìš©ìžê°€ GPS/ì‚¬ì§„ ì—…ë¡œë“œ â†’ ì„œë²„ ì €ìž¥ â†’ `mission_proofs` ìƒì„±
3. ê´€ë¦¬ìž ê²€ì¦ ë˜ëŠ” ìžë™ ê²€ì¦ â†’ `verified='Y'`

**C. ë°°íŒ…**

- ì‚¬ìš©ìžë“¤ì´ íŠ¹ì • íŒ€ì›ì˜ ë¯¸ì…˜ ì„±ê³µ/ì‹¤íŒ¨ì— ë² íŒ… (`bets`)
- ë§ˆê° ì‹œì ê¹Œì§€ ìˆ˜ì • ê°€ëŠ¥

**D. ì •ì‚°**

1. ì •ì‚° íŠ¸ë¦¬ê±° (ìŠ¤ì¼€ì¤„ëŸ¬/ê´€ë¦¬ìž ì‹¤í–‰)
2. **Redis ë¶„ì‚°ë½**ìœ¼ë¡œ ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
3. `transactions` ì‚½ìž… â†’ `accounts.balance` ì—…ë°ì´íŠ¸
4. `settlements` ì— ìš”ì•½ ì €ìž¥

---

## 5) ë¬¸ì œ ë° í•´ê²° ë°©ë²•

### **ë¬¸ì œ 1: ì´ì²´ ì‹œ ì¤‘ë³µ ì²˜ë¦¬ ë° ë°ì´í„° ì¶©ëŒ ë°œìƒ**

**ìƒí™©**

ì´ì²´ì‹œ í•˜ë‚˜ì˜ ì‚¬ìš©ìžê°€ ë¹ ë¥´ê²Œ ë²„íŠ¼ì„ ì—¬ëŸ¬ ë²ˆ ëˆ„ë¥¼ ë•Œ, ì •ì‚°í•˜ê¸° ìš”ì²­ì´ ì—¬ëŸ¬ ë²ˆ ê°€ëŠ” ê²½ìš°ê°€ ìžˆì–´ì„œ í•˜ë‚˜ì˜ ì´ì²´ ìš”ì²­ì— ëŒ€í•´ ì¤‘ë³µ íŠ¸ëžœìž­ì…˜ì´ ìƒì„±ë˜ëŠ” ë¬¸ì œê°€ ìžˆì—ˆìŠµë‹ˆë‹¤. ì´ë¡œ ì¸í•´ ì‚¬ìš©ìžê°€ ì›í•˜ì§€ ì•ŠëŠ” ì´ì²´ê°€ ë°œìƒí•˜ê±°ë‚˜, ì˜¤ë¥˜ê°€ ë°œìƒí•˜ëŠ” ê²½ìš°ê°€ ìžˆì—ˆìŠµë‹ˆë‹¤.

**ì„ íƒì§€**

| **ì„ íƒì§€** | **ìž¥ì ** | **ë‹¨ì ** |
| --- | --- | --- |
| **1. í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ìš”ì²­ ì œí•œ** | ë‹¨ìˆœí•˜ê³ , ìš”ì²­ì´ ë‘ ë²ˆ ë“¤ì–´ì˜¬ ê²½ìš°ë¥¼ ì›ì²œì°¨ë‹¨ | íƒ€ í´ë¼ì´ì–¸íŠ¸ í™•ìž¥ì‹œ ê°™ì€ ë¬¸ì œ ë°œìƒí•  ìˆ˜ ìžˆìŒ |
| **2. ê±°ëž˜ ê³ ìœ  ID(ref_id) + Unique ì œì•½ì¡°ê±´** | ë©±ë“±ì„± ë³´ìž¥ | ì˜ˆì™¸ ì²˜ë¦¬ í•„ìš” |
| **3. ë ˆë””ìŠ¤ ìºì‹œ í‚¤ë¡œ ìš”ì²­ ì¶”ì ** | ë¹ ë¦„ | TTL ì„¤ì • ê´€ë¦¬ í•„ìš” |

**íŒë‹¨ ê·¼ê±°**

ì¼ë‹¨ ìš”ì²­ ê·¸ ìžì²´ê°€ ì—¬ëŸ¬ ë²ˆ ì˜¤ëŠ” ê²½ìš°ë¥¼ ìµœì†Œí™” í•˜ê¸° ìœ„í•´ì„œ 1ë²ˆì€ ìš°ì„ ì ìœ¼ë¡œ ì ìš©í•˜ê³  ì´ì²´ íŠ¸ëžœìž­ì…˜ì—ì„œ ì¤‘ìš”í•œ ê²ƒì€ ë°ì´í„°ì˜ ì‹ ë¢°ì„±ì´ë¼ê³  ìƒê°í•˜ì—¬ ê°€ìž¥ ì•ˆì •ì ì¸ DBë‹¨ì—ì„œ ì œì•½ì„ ê±¸ì–´ì„œ ì²´í¬í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì¤‘ë³µì„ ë°©ì§€í•˜ì˜€ìŠµë‹ˆë‹¤.

**í•´ê²° ë°©ë²•**

- í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ë§ˆë‹¤  UUID ê¸°ë°˜ ref_id ìƒì„±
- ë™ì¼ ref_id ìž¬ìš”ì²­ ì‹œ, â€œì´ë¯¸ ì²˜ë¦¬ëœ ìš”ì²­ìž…ë‹ˆë‹¤.â€ë¥¼ ìµœì¢…ì ìœ¼ë¡œ ë°˜í™˜

**ê²°ê³¼**

- ì¤‘ë³µ ì´ì²´ 0ê±´
- ë„¤íŠ¸ì›Œí¬ ìž¬ì „ì†¡ ìƒí™©ì—ì„œë„ ì•ˆì •ì ì¸ ì²˜ë¦¬

### **ë¬¸ì œ 2 : ìž”ì•¡ ì—…ë°ì´íŠ¸ ë™ì‹œì„± ì¶©ëŒ**

**ìƒí™©**

ë‹¤ë¥¸ ì‚¬ìš©ìžì˜ ì´ì²´ì™€ ë™ì‹œì— ê°™ì€ ê³„ì¢Œì— ì ‘ê·¼í•˜ë©´ ìž”ì•¡ ê³„ì‚°ì´ ê¼¬ì´ëŠ” ê²½ìš°ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.

| ì„ íƒì§€ | ìž¥ì  | ë‹¨ì  |
| --- | --- | --- |
| **1. ë‚™ê´€ì  ë½ (Optimistic Lock)** | ì„±ëŠ¥ ìš°ìˆ˜, ë½ ê²½í•© ì—†ìŒ | ì¶©ëŒ ì‹œ ìž¬ì‹œë„ í•„ìš” |
| **2. ë¹„ê´€ì  ë½ (Pessimistic Lock)** | ì™„ë²½í•œ ì¼ê´€ì„± ë³´ìž¥ | ë½ ëŒ€ê¸°ì‹œê°„ ì¦ê°€ |
| **3. Redis ë¶„ì‚°ë½** | í™•ìž¥ì„± ì¢‹ìŒ | ì¸í”„ë¼ ê´€ë¦¬ ë¶€ë‹´ |

### íŒë‹¨ ê·¼ê±°

ì„œë¹„ìŠ¤ íŠ¸ëž˜í”½ì´ ë‚®ê³  ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ í™˜ê²½ì´ì—ˆê¸° ë•Œë¬¸ì—

**â‘¡ ë¹„ê´€ì  ë½(PESSIMISTIC_WRITE)** ì„ ì ìš©í–ˆìŠµë‹ˆë‹¤.

ë™ì‹œì— í•˜ë‚˜ì˜ ê³„ì¢Œì— ì ‘ê·¼í•˜ëŠ” ìš”ì²­ì€ ëŒ€ê¸°ì‹œì¼œ ì¼ê´€ì„± í™•ë³´.

### í•´ê²° ë°©ë²•

```java
@Lock(LockModeType.PESSIMISTIC_WRITE)
Account findByIdForUpdate(Long id);
```

### ê²°ê³¼

- ë™ì‹œ ì´ì²´ ìš”ì²­ 50ê±´ í…ŒìŠ¤íŠ¸ì—ì„œë„ ì •í™•í•œ ìµœì¢… ìž”ì•¡ ìœ ì§€
- í‰ê·  ì´ì²´ ì²˜ë¦¬ì‹œê°„ 1.0s â†’ 1.3s (ì¼ë¶€ ì¦ê°€í–ˆìœ¼ë‚˜ ì•ˆì •ì„± í™•ë³´)

### ë¬¸ì œ 3: ì´ì²´ ì¤‘ ì˜¤ë¥˜ ë°œìƒ ì‹œ ìž”ì•¡ ë¶ˆì¼ì¹˜ ë¬¸ì œ

### ìƒí™©

ë²Œê¸ˆ ë‚©ë¶€ë‚˜ ìƒê¸ˆ ë°°ë¶„ ê³¼ì •ì—ì„œ,

í•œ ì‚¬ìš©ìžì˜ ìž”ì•¡ ì°¨ê°ì´ ì„±ê³µí•˜ê³  ë‹¤ë¥¸ ì‚¬ìš©ìžì˜ ìž…ê¸ˆì´ ì‹¤íŒ¨í•˜ë©´

**ì´ ê³„ì¢Œí•©(balance sum)** ì´ ë§žì§€ ì•ŠëŠ” ë¶ˆì¼ì¹˜ ë¬¸ì œê°€ ìƒê²¼ìŠµë‹ˆë‹¤.

### ì„ íƒì§€

| ì„ íƒì§€ | ìž¥ì  | ë‹¨ì  |
| --- | --- | --- |
| **â‘  ë‹¨ìˆœ ë‘ ë²ˆì˜ DB UPDATE** | êµ¬í˜„ ê°„ë‹¨ | ì›ìžì„± ë³´ìž¥ ë¶ˆê°€ (í•œìª½ë§Œ ì„±ê³µ ê°€ëŠ¥) |
| **â‘¡ Spring @Transactional (ë‹¨ì¼ íŠ¸ëžœìž­ì…˜)** | ì›ìžì„± ë³´ìž¥ | ì„œë¹„ìŠ¤ ê³„ì¸µ ë³µìž¡ë„ ì¦ê°€ |
| **â‘¢ SAGA íŒ¨í„´ (ë³´ìƒ íŠ¸ëžœìž­ì…˜)** | ë¶„ì‚° íŠ¸ëžœìž­ì…˜ ëŒ€ì²´ ê°€ëŠ¥ | êµ¬í˜„ ë³µìž¡, ì„œë¹„ìŠ¤ ê·œëª¨ ëŒ€ë¹„ ê³¼í•¨ |

### íŒë‹¨ ê·¼ê±°

ì„œë¹„ìŠ¤ê°€ ë‹¨ì¼ DB ë‚´ì—ì„œ ë™ìž‘í–ˆê¸° ë•Œë¬¸ì—

**â‘¡ @Transactional ê¸°ë°˜ì˜ ë‹¨ì¼ íŠ¸ëžœìž­ì…˜**ì´ ê°€ìž¥ ì ì ˆí–ˆìŠµë‹ˆë‹¤.

ë‹¨, íŠ¸ëžœìž­ì…˜ ì•ˆì—ì„œ ì˜ˆì™¸ ë°œìƒ ì‹œ ë³´ìƒ ë¡œì§ì„ êµ¬í˜„í•˜ì—¬,

ëª¨ë“  ì´ì²´ê°€ ì‹¤íŒ¨ ì‹œ ì´ì „ ìƒíƒœë¡œ ì™„ì „ížˆ ë³µêµ¬ë˜ë„ë¡ ì„¤ê³„í–ˆìŠµë‹ˆë‹¤.

### í•´ê²° ë°©ë²•

```java
@Transactional
public void transfer(Long fromId, Long toId, BigDecimal amount) {
    Account from = accountRepository.findById(fromId)
        .orElseThrow(() -> new AccountNotFoundException());
    Account to = accountRepository.findById(toId)
        .orElseThrow(() -> new AccountNotFoundException());

    if (from.getBalance().compareTo(amount) < 0) {
        throw new InsufficientBalanceException();
    }

    from.withdraw(amount);
    to.deposit(amount);

    transactionRepository.save(new Transaction(from, to, amount, LocalDateTime.now()));
}

```

### ê²°ê³¼

- ì´ì²´ ì¤‘ ì˜ˆì™¸ ë°œìƒ ì‹œ ëª¨ë“  ë³€ê²½ ìžë™ ë¡¤ë°±
- í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ 100íšŒ ì¤‘ ë°ì´í„° ë¶ˆì¼ì¹˜ 0ê±´
- ì „ì²´ ì´ì²´ íŠ¸ëžœìž­ì…˜ í‰ê·  ì²˜ë¦¬ì‹œê°„ 0.9s

---

## 5) ì¸ì¦ ë° ë³´ì•ˆ

- **ì¸ì¦:** JWT + HttpOnly Secure Cookie
- **ì¸ê°€:** ê·¸ë£¹/ë¯¸ì…˜ ì ‘ê·¼ ì‹œ ê¶Œí•œ(ROLE) ê¸°ë°˜ ì ‘ê·¼
- **ìž…ë ¥ ê²€ì¦:**  @Value ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•œ DTO ë‹¨ìœ„ ìž…ë ¥ê²€ì¦
- **ë¹„ë°€ê´€ë¦¬:** Jenkins Credential, .env íŒŒì¼ ë¶„ë¦¬

---

## 6) ì„±ëŠ¥ ë° ëª¨ë‹ˆí„°ë§

- **ìºì‹±:** Redisë¡œ ê·¸ë£¹/ë¯¸ì…˜ ìºì‹œ (TTL 5~15ë¶„)
- **ë¹„ë™ê¸° ì²˜ë¦¬:** ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§• ë¹„ë™ê¸°í™” â†’ ì‘ë‹µì†ë„ 2.0s â†’ 0.5s
- **í…ŒìŠ¤íŠ¸:** JUnit5 + Testcontainers(MySQL/Redis)
- **ë¡œê¹…:** JSON êµ¬ì¡°í™” ë¡œê·¸ + Grafana/í”„ë¡œë©”í…Œìš°ìŠ¤ëŒ€ì‹œë³´ë“œ

---

## 7) CI/CD ë° ë°°í¬

- **Jenkins íŒŒì´í”„ë¼ì¸**
    - GitHub PR â†’ ë¹Œë“œ/í…ŒìŠ¤íŠ¸ â†’ Docker ì´ë¯¸ì§€ â†’ ë°°í¬ ìžë™í™”
- **ìš´ì˜ í™˜ê²½**
    - AWS EC2 + Nginx (HTTPS)
- **ë¡¤ë°±**
    - Docker ì´ë¯¸ì§€ íƒœê·¸ ë‹¨ìœ„ ìž¬ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì¤€ë¹„

---

## 8) ê²°ê³¼ ë° ì„±ê³¼

- ì •ì‚° ì¤‘ë³µ ì‹¤í–‰ 0ê±´ (ë½/ë©±ë“±í‚¤)
- ì•Œë¦¼ ì´ë²¤íŠ¸ ëˆ„ë½ë¥  90% ì´ìƒ ê°ì†Œ (Kafka)
- ë³´ì•ˆ ê°•í™”: JWT + HttpOnly ì¿ í‚¤ë¡œ í† í° íƒˆì·¨ ë°©ì§€
- ì£¼ìš” ê¸°ëŠ¥(API/ì •ì‚°/ë°°íŒ…) 100% êµ¬í˜„ ì™„ë£Œ

### 9) í”„ë¡œì íŠ¸ ì´ë¯¸ì§€

- ë¯¸ì…˜ìˆ˜í–‰ - ìš´ë™í•˜ê¸°(ìž¥ì†Œë¯¸ì…˜)
    
    ![image.png](/images/godLifeRouting/image%201.png)
    
- ë¯¸ì…˜ìˆ˜í–‰ - ë¬¼ê±´ì´¬ì˜

![image.png](/images/godLifeRouting/image%202.png)

- ë² íŒ…í•˜ê¸° - íŒ€ì›ì˜ ë¯¸ì…˜ ìˆ˜í–‰ ì—¬ë¶€ë¥¼ ë†“ê³  ë°°íŒ…

![image.png](/images/godLifeRouting/image%203.png)

- ì •ì‚° ë° ìº˜ë¦°ë”ì™€ ê°¤ëŸ¬ë¦¬ - ë¯¸ì…˜ ê²°ê³¼ë¥¼ ìº˜ë¦°ë”ì™€ ê°¤ëŸ¬ë¦¬ì—ì„œ í™•ì¸ ë° ì •ì‚°ì—ì„œ ë‚¸ ë²Œê¸ˆ í™•ì¸ê°€ëŠ¥

![image.png](/images/godLifeRouting/image%204.png)